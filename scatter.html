<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Scatter Chart</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
  <div style="display: flex; gap: 24px; align-items: flex-start;">
  <div id="chart_div" style="width:800px; height:800px;"></div>

  <div id="note_box" style="
    width: 260px;
    font-size: 14px;
    line-height: 1.6;
    border-left: 3px solid #ccc;
    padding-left: 16px;
  ">
    每個點代表一角色<br>
    使用左鍵拖曳可局部放大<br>
    右鍵可重置縮放倍率<br>
    <br>
    會升攻的貓以升攻前後加權平均計算<br>
    權重正比於攻擊力*對應KB數<br>
    其中死前存活會視為0.5個KB<br>
  </div>
</div>

  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      // 修改為你的 Spreadsheet ID 和 Sheet 名稱
      const spreadsheetId = '1A6OllbUHCiVlk_gbyYRW2JkNIGpuqvv8oRGsTT-Nh0w';
      const sheetName = '泛用輸出'; 

      const query = new google.visualization.Query(
        `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?sheet=${sheetName}&range=B1:F`
      );

      query.send(handleQueryResponse);
    }

    function handleQueryResponse(response) {
      if (response.isError()) {
        console.error('Error in query: ' + response.getMessage());
        return;
      }

      const data = response.getDataTable();

      // ✅ 檢查是否成功讀取資料
      console.log(data.toJSON());

      // DataView 設定 tooltip 和 X/Y 欄位
      const view = new google.visualization.DataView(data);
      view.setColumns([
        1, // X 軸 (C欄)
        2, { type: 'string', role: 'tooltip', calc: (dt, row) => `${dt.getValue(row,0)}` }, // D欄 + tooltip
        3, { type: 'string', role: 'tooltip', calc: (dt, row) => `${dt.getValue(row,0)}` }, // E欄 + tooltip
        4, { type: 'string', role: 'tooltip', calc: (dt, row) => `${dt.getValue(row,0)}` }  // F欄 + tooltip
      ]);

      const options = {
        title: 'Scatter Plot',
        hAxis: { title: '射程(接觸點)' },
        vAxis: { title: 'DPS(秒平均輸出)' },
        legend: { position: 'right' },
        
        height: 800,

        explorer: {
          actions: ['dragToZoom','rightClickToReset'],
        axis: 'both',
        keepInBounds: true,
        maxZoomIn: 0.02
        }
      };

      const chart = new google.visualization.ScatterChart(
        document.getElementById('chart_div')
      );
      chart.draw(view, options);
    }
  </script>
</body>
</html>








